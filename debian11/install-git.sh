#!/bin/bash

############################################################
############################################################
# 					Compatibilité système		 		   #
############################################################
############################################################

# ----------------------------------------------------------
# [Pour Comparer votre version d'OS à
#  celles mentionnées ci-dessous]
#
# ¤ distributions Ubuntu:
#		lsb_release -a
#
# ¤ distributions CentOS:
# 		cat /etc/redhat-release
#
#
# ----------------------------------------------------------

# ----------------------------------------------------------
# testé pour:
#
#
#
#
# ----------------------------------------------------------
# (Ubuntu)
# ----------------------------------------------------------
#
# ¤ [TEST-OK]
#
# 	[Distribution ID: 	Ubuntu]
# 	[Description: 		Ubuntu 16.04 LTS]
# 	[Release: 			16.04]
# 	[codename:			xenial]
#
#
#
#
#
#
# ----------------------------------------------------------
# (CentOS)
# ----------------------------------------------------------
#
#
#
# ...
# ----------------------------------------------------------




# --------------------------------------------------------------------------------------------------------------------------------------------
##############################################################################################################################################
#########################################							ENV								##########################################
##############################################################################################################################################
# --------------------------------------------------------------------------------------------------------------------------------------------
export MAISON_OPERATIONS
MAISON_OPERATIONS=$(pwd)
export GIT_DESIRED_VERSION="2.35.1"


######### -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -
######### -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -

# --------------------------------------------------------------------------------------------------------------------------------------------
##############################################################################################################################################
#########################################							SYS dependencies		##########################################
##############################################################################################################################################
sudo apt-get install -y curl
# --------------------------------------------------------------------------------------------------------------------------------------------
##############################################################################################################################################
#########################################							FONCTIONS						##########################################
##############################################################################################################################################

# --------------------------------------------------------------------------------------------------------------------------------------------
##############################################################################################################################################
#########################################							OPS								##########################################
##############################################################################################################################################
# --------------------------------------------------------------------------------------------------------------------------------------------



# --
mkdir build_from_src_git/
cd build_from_src_git/

curl -LO https://github.com/git/git/archive/refs/tags/v${GIT_DESIRED_VERSION}.tar.gz

mkdir sourcecode/

tar -xvf ./v${GIT_DESIRED_VERSION}.tar.gz -C sourcecode/

cd sourcecode/git-${GIT_DESIRED_VERSION}/

# ---
# -- 1./ first install all build dependencies
#
sudo apt-get update -y
sudo apt-get install -y build-essential libssl-dev libghc-zlib-dev libcurl4-gnutls-dev libexpat1-dev gettext unzip

# ---
# -- 2./ then run the build from source
#
sudo make prefix=/usr/local all

# ---
# -- 3./ then run the installation script
#
sudo make prefix=/usr/local install


# ---
# -- 4./ Finally check installed git version matches  GIT_DESIRED_VERSION
#
git --version
