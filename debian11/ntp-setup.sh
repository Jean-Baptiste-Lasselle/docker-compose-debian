#!/bin/bash
# Hôte Docker sur centos 7
############################################################
############################################################
# 					Compatibilité système		 		   #
############################################################
############################################################

# ----------------------------------------------------------
# [Pour Comparer votre version d'OS à
#  celles mentionnées ci-dessous]
#
# ¤ distributions Ubuntu:
#		lsb_release -a
#
# ¤ distributions CentOS:
# 		cat /etc/redhat-release
#
#
# ----------------------------------------------------------

# ----------------------------------------------------------
# testé pour:
#
#
#
#
# ----------------------------------------------------------
# (Ubuntu)
# ----------------------------------------------------------
#
# ¤ [TEST-OK]
#
# 	[Distribution ID: 	Ubuntu]
# 	[Description: 		Ubuntu 16.04 LTS]
# 	[Release: 			16.04]
# 	[codename:			xenial]
#
#
#
#
#
#
# ----------------------------------------------------------
# (CentOS)
# ----------------------------------------------------------
#
#
#
# ...
# ----------------------------------------------------------




# --------------------------------------------------------------------------------------------------------------------------------------------
##############################################################################################################################################
#########################################							ENV								##########################################
##############################################################################################################################################
# --------------------------------------------------------------------------------------------------------------------------------------------
# export MAISON_OPERATIONS
export MAISON_OPERATIONS=$(pwd)

######### -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -
######### -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -# -


# --------------------------------------------------------------------------------------------------------------------------------------------
##############################################################################################################################################
#########################################							FONCTIONS						##########################################
##############################################################################################################################################


installNTPclient () {
	sudo apt-get install -y ntp
  sudo systemctl restart ntp
  ntpq -p
}

# --------------------------------------------------------------------------------------------------------------------------------------------
# Cette fonction permet de re-synchroniser l'hôte docker sur un serveur NTP, sinon# certaines installations dépendantes
# de téléchargements avec vérification de certificat SSL
syncNtp () {

	export POKUS_NTP_POOL=$(cat /etc/ntp.conf | grep pool | grep -v '#' | head -n 1 | awk '{print $2}')
  echo "POKUS_NTP_POOL=[${POKUS_NTP_POOL}]"
	sudo apt-get install -y ntpdate
	date
	sudo systemctl stop ntp
	sudo ntpdate -s "${POKUS_NTP_POOL}"
	sudo systemctl restart ntp
	date
}


configureTimeZone () {
	timedatectl list-timezones --no-pager | grep Europe | grep Paris
	sudo timedatectl set-timezone Europe/Paris
}


# --------------------------------------------------------------------------------------------------------------------------------------------
##############################################################################################################################################
#########################################							OPS								##########################################
##############################################################################################################################################
# --------------------------------------------------------------------------------------------------------------------------------------------



# synchroniserSurServeurNTP

configureTimeZone
installNTPclient
syncNtp
